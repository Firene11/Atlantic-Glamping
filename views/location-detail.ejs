<%-include('partials/head', { pageTitle: location.title }) %>
<body>
  <%-include("partials/nav") %>
  <h1><%= location.title %></h1>
  <p>City: <%= location.city %></p>
  <p>Province: <%= location.province %></p>
  <% location.reviews.forEach(review => { %>
    <%-include("partials/review", { review: review })  %> <!-- Pass the review variable -->
    <!-- Edit Review Button for each review -->
    <button class="edit-review-btn" data-review-id="<%= review.id %>">Edit Review</button>
  <% }); %>

  <!-- Add Review Button -->
  <button id="add-review-btn">Add Review</button>
  <form id="review-form" action="/api/reviews/locations/<%= location.id %>/reviews" method="post" enctype="multipart/form-data">
    <input type="hidden" name="locationId" value="<%= location.id %>">
    <textarea name="content" placeholder="Write your review..."></textarea>
    <select name="rating">
      <option value="1">1 star</option>
      <option value="2">2 stars</option>
      <option value="3">3 stars</option>
      <option value="4">4 stars</option>
      <option value="5">5 stars</option>
    </select>
    <input type="file" name="image" accept="image/*">
    <button type="submit">Submit Review</button>
  </form>
  

  <script>
    const locationId = '<%= location.id %>'; // Extract the location ID from the server-side variable
  
    // Handling the Add Review button click
    document.getElementById('add-review-btn').addEventListener('click', function() {
      const reviewForm = document.getElementById('review-form'); // Corrected form ID
      reviewForm.style.display = 'block';
      reviewForm.action = `/api/reviews/locations/${locationId}/reviews`; // Set action for adding a review
    });
  
    // Handling the Edit Review buttons click
    document.querySelectorAll('.edit-review-btn').forEach(function(button) {
      button.addEventListener('click', function() {
        const reviewId = button.getAttribute('data-review-id');
  
        // Fetch the review data by reviewId
        fetch(`/api/reviews/${reviewId}`) // Update the fetch path
          .then(response => response.json())
          .then(reviewData => {
            // Populate the review form with the existing review data
            const reviewForm = document.getElementById('review-form'); // Corrected form ID
            reviewForm.style.display = 'block';
            reviewForm.action = `/api/reviews/locations/${locationId}/reviews/${reviewId}`; // Update the form's action for editing
            reviewForm.querySelector('textarea[name="content"]').value = reviewData.content;
            reviewForm.querySelector('select[name="rating"]').value = reviewData.rating;
          })
          .catch(error => {
            console.error("Error fetching review:", error);
          });
      });
    });
  </script>
  
  <%-include("partials/foot")  %>
</body>
</html>


